<!DOCTYPE html>
<html>
<head>
    <title>Expense Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body{
            background-color: rgb(210, 210, 231);
        }
        #chartContainer {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            width: 50%;
            height: 50%;
            align-items: center;
        }
        canvas {
            margin: 10px;
        }
    </style>
</head>
<body>
    <header>
        <a href="./core.html">Home page</a>
    </header>
    <h1>Expense Visualization</h1>
    <div id="chartContainer">
        <canvas id="expenseChart" width="800" height="400"></canvas>
    </div>

    <script>
        const transactions = JSON.parse(localStorage.getItem("transactions")) || [];

        // Prepare data for the chart (Income, Expense, Balance)
        const dates = [...new Set(transactions.map(tx => tx.date))].sort(); // Unique, sorted dates

        const incomeData = dates.map(date => {
            let sum = 0;
            transactions.forEach(tx => {
                if (tx.type === "Income" && tx.date === date) {
                    sum += tx.amount;
                }
            });
            return sum;
        });

        const expenseData = dates.map(date => {
            let sum = 0;
            transactions.forEach(tx => {
                if (tx.type === "Expense" && tx.date === date) {
                    sum += tx.amount;
                }
            });
            return sum;
        });

        const balanceData = [];
        let currentBalance = 0;
        dates.forEach(date => {
            let incomeForDate = 0;
            let expenseForDate = 0;
            transactions.forEach(tx => {
                if (tx.type === 'Income' && tx.date === date) {
                    incomeForDate += tx.amount;
                } else if (tx.type === 'Expense' && tx.date === date) {
                    expenseForDate += tx.amount;
                }
            });
            currentBalance += incomeForDate - expenseForDate;
            balanceData.push(currentBalance);
        });

        const ctx = document.getElementById('expenseChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    {
                        label: 'Income',
                        data: incomeData,
                        borderColor: 'green',
                        fill: false,
                    },
                    {
                        label: 'Expense',
                        data: expenseData,
                        borderColor: 'red',
                        fill: false,
                    },
                    {
                        label: 'Balance',
                        data: balanceData,
                        borderColor: 'blue',
                        fill: false,
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Amount'
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>